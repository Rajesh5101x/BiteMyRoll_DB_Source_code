{% extends "layout.html" %}
{% block content %}
<style>
  .admin-card{
    width:95%;margin:1rem auto;padding:1rem 1.2rem;background:#222;
    border:1px solid #444;border-radius:8px;color:#eee;
  }
  .admin-head{display:flex;justify-content:space-between;align-items:center}
  .badge-del{padding:.25rem .6rem;border-radius:4px;font-size:.8rem;font-weight:600}
  .delivered{background:#2bcf7e;color:#101010}
  .pending  {background:#ff9d2d;color:#101010}
  .btn-deliver{
    background:#2bcf7e;border:none;color:#101;padding:.4rem .9rem;
    border-radius:6px;font-weight:600;cursor:pointer
  }
  .btn-deliver:hover{opacity:.9}
  ul{list-style:none;margin:.5rem 0 0 0;padding-left:0}
</style>

<h1 style="text-align:center;color:#ffae36;margin:1.3rem 0">All Orders</h1>

{% for box in orders %}
<div class="admin-card">
  <div class="admin-head">
    <div>
      <strong>#{{ box.order.id }}</strong> –
      {{ box.order.placed_at.strftime("%d %b %Y %H:%M") }} |
      {{ box.user.username }} ({{ box.user.email }})
    </div>
    <span class="badge-del {{ 'delivered' if box.order.delivered else 'pending' }}">
      {{ "Delivered" if box.order.delivered else "Pending" }}
    </span>
  </div>

  <ul>
    {% for i in box.rows %}
      <li>{{ i.qty }} × {{ i.size }} {{ i.name }}</li>
    {% endfor %}
  </ul>

  {% if not box.order.delivered %}
  <form method="POST"
        action="{{ url_for('mark_delivered', order_id=box.order.id) }}"
        style="margin-top:.6rem"
        onsubmit="return confirm('Mark order #{{ box.order.id }} as delivered?');">
    {{ csrf_token() }}
    <button type="submit" class="btn-deliver">Mark Delivered</button>
  </form>
  {% endif %}
</div>
{% endfor %}
{% endblock %}
